<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<title>Игра «Стоп‑сигнал» с динамическими цветами</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Exo+2:wght@300;400;600;700&display=swap');
  body { 
    font-family: 'Exo 2', sans-serif; 
    background: #f6f0ff; 
    color: #1b1130; 
    display: flex; 
    flex-direction: column; 
    align-items: center; 
    padding-top: 60px; 
    min-height: 100vh; 
    margin: 0; 
    position: relative;
  }
  body::before,
  body::after{
    content:'';
    position:fixed;
    width:520px;
    height:520px;
    border-radius:45% 55% 55% 45%;
    background:rgba(142,111,255,.18);
    z-index:-2;
    filter:blur(0);
  }
  body::before{top:-120px;left:-160px;}
  body::after{bottom:-180px;right:-160px;}
  .exit-button {
    position: fixed;
    top: 20px;
    right: 20px;
    z-index: 1000;
    padding: 10px 26px;
    font-size: 1rem;
    font-weight: 600;
    color: #fff;
    background: linear-gradient(120deg, #6630ff, #a353ff);
    border: none;
    border-radius: 999px;
    box-shadow: 0 18px 35px rgba(111,55,230,.35);
    cursor: pointer;
    user-select: none;
    transition: transform 0.25s, box-shadow 0.25s;
    font-family: 'Exo 2', sans-serif;
  }
  .exit-button:hover {
    transform: translateY(-2px);
    box-shadow: 0 22px 40px rgba(111,55,230,.45);
  }
  #gameArea { 
    width: 450px; 
    height: 300px; 
    border: 3px solid rgba(107,53,242,.3); 
    border-radius: 24px; 
    display: flex; 
    justify-content: center; 
    align-items: center; 
    font-size: 72px; 
    user-select: none; 
    text-shadow: none; 
    transition: color 0.5s ease; 
    background: #ffffff;
    box-shadow: 0 25px 80px rgba(96,33,201,.15);
    color: #6b35f2;
    font-weight: 600;
  }
  button { 
    margin-top: 30px; 
    padding: 18px 48px; 
    font-size: 22px; 
    border-radius: 999px; 
    border: none; 
    cursor: pointer; 
    background: linear-gradient(120deg, #6630ff, #a353ff); 
    color: #fff; 
    box-shadow: 0 18px 35px rgba(111,55,230,.35); 
    transition: transform 0.25s, box-shadow 0.25s; 
    font-weight: 600;
  }
  button:disabled { background: #c7a8ff; cursor: not-allowed; box-shadow: none; }
  button:hover:not(:disabled) { transform: translateY(-2px); box-shadow: 0 20px 40px rgba(111,55,230,.45); }
  #stats { margin-top: 30px; font-size: 22px; font-weight: 600; min-height: 44px; color: #6b35f2;}
  #instructions { 
    max-width: 500px; 
    text-align: center; 
    margin-bottom: 30px; 
    font-size: 18px; 
    background: #ffffff;
    padding: 28px;
    border-radius: 24px;
    box-shadow: 0 25px 80px rgba(96,33,201,.15);
    color: #6f6892;
    font-weight: 600;
  }
</style>
</head>
<body>

<button class="exit-button" onclick="exitGame()" title="Выход на главную">Выход</button>

<div id="instructions">
  Нажмите «Старт», потом при появлении «GO» нажмите пробел как можно быстрее.<br>
  Если увидите «STOP», не нажимайте пробел!<br>
  Тренируйте ингибиторный контроль и реакцию.
</div>

<div id="gameArea">ЖМИ СТАРТ</div>
<button id="startBtn">Старт</button>
<div id="stats"></div>

<script>
  const gameArea = document.getElementById('gameArea');
  const startBtn = document.getElementById('startBtn');
  const stats = document.getElementById('stats');

  let waitingForGo = false;
  let canPressSpace = false;
  let reactionStartTime = 0;
  let reactionTimes = [];
  let mistakes = 0;
  let trials = 0;
  let showingResult = false;

  // Функция генерации яркого HSL цвета (hue 0-360, sat 65-100%, light 50-70%)
  function getRandomBrightColor() {
    const hue = Math.floor(Math.random() * 360);
    const saturation = Math.floor(Math.random() * 35) + 65; // 65-100%
    const lightness = Math.floor(Math.random() * 20) + 50; // 50-70%
    return `hsl(${hue}, ${saturation}%, ${lightness}%)`;
  }

  function getRandomDelay(min = 800, max = 2000) {
    return Math.floor(Math.random() * (max - min + 1)) + min;
  }

  function startTrial() {
    showingResult = false;
    gameArea.style.color = '#eee'; // сброс цвета
    gameArea.textContent = '...Подождите';
    waitingForGo = true;
    canPressSpace = false;
    trials++;
    const delay = getRandomDelay();
    setTimeout(() => {
      if (Math.random() < 0.3) {
        gameArea.textContent = 'STOP';
        gameArea.style.color = getRandomBrightColor();
        waitingForGo = false;
        canPressSpace = false;
        setTimeout(startTrial, 1000);
      } else {
        gameArea.textContent = 'GO';
        gameArea.style.color = getRandomBrightColor();
        waitingForGo = false;
        canPressSpace = true;
        reactionStartTime = performance.now();
        setTimeout(() => {
          if (canPressSpace) {
            mistakes++;
            canPressSpace = false;
            showResult('Слишком медленно!');
          }
        }, 1500);
      }
    }, delay);
  }

  function showResult(text) {
    showingResult = true;
    gameArea.textContent = text;
    gameArea.style.color = '#ffcc00';
    updateStats();
    setTimeout(() => {
      startTrial();
    }, 1000);
  }

  function updateStats() {
    stats.textContent = `Попыток: ${trials}, Ошибок: ${mistakes}`;
  }

  startBtn.onclick = function() {
    if (showingResult) return;
    startBtn.disabled = true;
    reactionTimes = [];
    mistakes = 0;
    trials = 0;
    stats.textContent = '';
    startTrial();
  };

  window.addEventListener('keydown', (e) => {
    if (e.code === 'Space' && !showingResult) {
      if (canPressSpace) {
        const reactionTime = performance.now() - reactionStartTime;
        reactionTimes.push(reactionTime);
        canPressSpace = false;
        showResult(`Отлично! ${Math.round(reactionTime)} мс`);
      } else if (!waitingForGo) {
        mistakes++;
        canPressSpace = false;
        showResult('ОШИБКА!');
      }
    }
  });

  window.addEventListener('keydown', e => {
    if (e.code === 'Escape') {
      startBtn.disabled = false;
      gameArea.textContent = 'ЖМИ СТАРТ';
      gameArea.style.color = '#eee';
      canPressSpace = false;
      waitingForGo = false;
      showingResult = false;
      updateStats();
    }
  });

  function exitGame() {
    window.location.href = '../test.html';
  }
</script>

</body>
</html>
